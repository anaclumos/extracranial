---
lang: 'ko'
slug: '/C222D1'
---

import DisplayFlex from '@site/src/components/DisplayFlex'

## 개요

기술에 친숙하지 않은 이용자가 학습 곡선 없이 아이폰에서도 동일한 키보드 경험을 할 수 있도록
키보드를 제작하는 [[Project|프로젝트]].

## [[2022-12-19]]

[[아이폰 천지인 자판 프로젝트의 실현 가능성 연구]]를 통해 제작이 충분히 가능함을 확인.
다음과 같이 기술 [[Proof of Concept|개념 증명]] 완료.

### 기술의 구현 방향

일단 `ViewController` 내에 버튼과 로직을 때려박아 개발하는 것은 쉬워보임.
다만 코드를 분산시키고 좋은 품질을 유지하기 위해 [[SwiftUI]]를 사용하는 방안을 연구 중.
[이런 문서](https://www.createwithswift.com/using-a-swiftui-view-in-a-uikit-app/)를 볼 때
UIKit ViewController 안에서도 SwiftUI View를 이용하는 것이 가능해보임.
2020년에 소개된 [SwiftUI Grid Layout](https://blog.logrocket.com/understanding-the-swiftui-grid-layout/)을 활용하면 깔끔한 구현체를 만들 수 있을 것으로 기대.

CloudKit Persistence를 이용하여 사용자 설정이 iCloud를 통해 동기화되도록 구현할 예정.
부가적인 기능 없이 MVP로 천지인 입력이 가능한 키보드로 구현할 생각.

![[54CE6E.png]]

## [[2022-12-20]]

Grid 대신 VStack과 HStack으로 충분하다고 판단하여 개발함.
버튼을 눌렀을 때 간단한 동작을 하도록 구현.
숫자 버튼을 눌렀을 때 키보드를 변환하도록 만들기 위해 2가지 뷰를 바뀌도록 해야할 듯?
System 색을 맞추는 것에 약간의 시간이 들었다.
예상과 다르게 아이폰의 키보드 컬러는 `Color(uiColor: UIColor.system...)`에서의 어떤 Semantic Color와도 일치하지 않았다.
그래서 일단 눈대중으로 다크모드와 라이트모드에 적당히 괜찮은 색깔을 보여주도록 하드코딩해두었다.
이렇게 할 경우 접근성의 면에서 문제가 발생할 수 있다 (예: 사용자가 High Contrast를 켜놓은 경우 등.)
일단 MVP 개발까지를 위해 이 정도로 타협하기로 했다.

<DisplayFlex>
![[A02D58.png]]
![[85D135.png]]
</DisplayFlex>

잠깐 타이핑의 로직을 생각해보았는데, 적당히 골치 아프겠다.
엣지케이스가 꽤 많다.

## [[2022-12-27]]

천지인 로직 구현 시작.
키보드를 제작하는 것에는 [raywenderlich](https://www.kodeco.com/49-custom-keyboard-extensions-getting-started)가 참고하기 좋았다.

`NSRange`와 `setMarkedText`를 사용하여 마지막 텍스트를 선택할 수 있는 방법에 대해서 연구해보고 있었는데, 아무래도 기대와 조금 다르게 동작하여 사용에 어려움이 있다.

```swift
let range = NSRange(location: 1, length: 0)
proxy.setMarkedText(text, selectedRange: range)
```

![[5DFD9A.png]]

`ㅇ` 근처 배경에 회색 배경이 있음을 확인하자.
그리고 이거는 보니까 중국어처럼 글자 조합 후에 글씨가 입력되는 경우를 위한 것 같다.
타이핑 도중에는 검색이 안 된다.

- [유니코드 옛한글 1638750자, 문자 집합 위키](https://charset.fandom.com/ko/wiki/%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C_%EC%98%9B%ED%95%9C%EA%B8%80_1638750%EC%9E%90)
- [현대 한글 11172자/28자씩/국가 표준 완성형 통합, 문자 집합 위키](https://charset.fandom.com/ko/wiki/%ED%98%84%EB%8C%80_%ED%95%9C%EA%B8%80_11172%EC%9E%90/28%EC%9E%90%EC%94%A9/%EA%B5%AD%EA%B0%80_%ED%91%9C%EC%A4%80_%EC%99%84%EC%84%B1%ED%98%95_%ED%86%B5%ED%95%A9)

천지인 로직을 그냥 선처리해놓고 json에 덤핑하여 사용하면 어떨까 실험을 해보았다.
[4년 전 조성현이 무척이나 나를 도와주고 있다!](https://github.com/anaclumos/hangulbreak/blob/master/Python/HangulDecomposeModule.py)

![[380E26.png]]

근데 단순하게 마지막 한 글자를 가지고 처리하는 것은 예외 사항이 많다. 우선 전 두 글자를 읽어와서 검색한 이후, 없으면 한 글자를 확인해야겠다.

- `안ㅅ` + `ㅅ` = `않`
- `앉` + `ㅡ` = `안즈`: 마지막 종성 하나가 추출 가능한지 확인해야 한다.

어차피 가능한 한글의 가지 수는 약 만 여개인데다가, 누를 수 있는 버튼은 10개이다.
`않`을 입력하기 위한 `안ㅅ` 등의 항목을 추가하더라도
조합은 많아야 10만 단위에서 넘어가지 않을 것으로 예상한다.
충분히 하드코딩하고 사용할 가치가 있다.

반면에 State Machine 기반으로 가장 그럴 듯한 구현체로 [김윤상](https://github.com/kys-zeda)님의 [[Java]] [[Android]] [천지인 키보드](https://blog.naver.com/irineu2/220337849480)([kys-zeda/chunjiin](https://github.com/kys-zeda/chunjiin/blob/master/Chunjiin/src/com/zeda/chunjiin/Chunjiin.java))를 발견했다.
오토마타 기반으로 제작하셨는데, 아주 잘 작동한다.
보아하니 한국 대학 컴공과에서는 State Machine 수업을 할 때 천지인을 하나의 예제로 사용하나보다.
우린 좁은 그리드 위의 팩맨으로 했었는데!

어쨌든 하드코딩을 해서 사용할지, 아니면 오토마타 로직을 사용할지 고민이 된다.
하드코딩 JSON을 만들 경우 다른 개발자들이 "정말 아무 Friction 없이" 가져다가 사용할 수 있다.
오토마타 로직을 사용할 경우... 좋은 점이 있나?
로직이 깔끔할 것 같지도 않고 잘 모르겠다.

## [[2022-12-28]]

![[9DA152.png]]

종성에 한해서는 지도를 완성했다.

![[54BAFC.png]]

천과 인도 완성했다.

- `할까` 케이스 고려해야함 → 완성

## 그 외

- `extractable 종성` 케이스 고려해서 천, 지, 인 경우 보정해야함

## 있으면 좋을

- 간단한 맞춤법 검사
- 일본식 이모티콘: `( •_•)`, `⊹⋛⋋( ՞ਊ ՞)⋌⋚⊹`, 등. 네이버 스마트 키보드의 기능 중 꽤 좋은 기능이었다.
- 오타 보정
  - [모바일 키보드, 스마트보드에 AI 적용하기](https://www.slideshare.net/deview/135-ai)
  - [모바일 키보드, 스마트보드에 AI 적용하기](https://tv.naver.com/v/4578547)
